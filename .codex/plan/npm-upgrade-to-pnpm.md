# npm-upgrade-to-pnpm

> taskId：20260104-104202-npm-upgrade-to-pnpm
> 生成时间：2026-01-04 10:42:02
> 仓库根目录：/private/var/folders/gf/9p6m7pms4pb0nn6tqw5cjfvw0000gn/T/vibe-kanban-dev/worktrees/f48e-npm-upgrade/poker-set
> Git：penpen/f48e-npm-upgrade @ 26520c5（dirty=是）
> 仓库级配置：未发现
> 上下文快照：`.codex/context.md`（由 collect_context 生成）
> 证据目录：`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/`（命令输出/差异快照等只落盘引用）
> 约定索引：未发现
> AGENTS 线索：未发现（可用 collect_context 定位）

## 0. 输入与范围（可溯源）
- 需求/问题描述：...
- 目标用户/使用场景：...
- 范围：
  - 包含：...
  - 不包含：...
- 相关链接（issue/PR/文档）：...

## 1. 证据索引（E#，强制引用）
规则：
- 所有关键结论/决策/验收判定必须引用 E#（例如：依据 E3/E7）。
- 命令输出只落盘到 `.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/`，正文仅写“路径 + 结论摘要”。
- 最佳实践来源优先级：仓库既有约定与代码模式 > AGENTS 约束 > 官方文档（Context7）> 经验推断（推断必须可验证）。

- E1（项目画像快照）：`.codex/context.md`
  - 类型：command-output
  - 摘要：...
- E2（仓库约定索引）：未发现
  - 类型：repo-doc
  - 摘要：...
- E3（AGENTS 约束线索）：未发现（可用 collect_context 定位）
  - 类型：repo-constraint
  - 摘要：...
- E4（关键配置/护栏摘要）：`eslint.config.*` / `tsconfig.json` / `next.config.*` / `package.json scripts`
  - 类型：repo-config
  - 摘要：...
- E5（官方/最佳实践：Context7）：`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/context7.md`（或“不适用：... + 替代验证方式”）
  - 类型：context7
  - 摘要：...
- E6（risk_gate 输出）：`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/risk_gate.txt`
  - 类型：command-output
  - 摘要：...
- E7（git diff 快照）：`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/patch.diff`
  - 类型：command-output
  - 摘要：...
- E8（验证日志：lint）：`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/lint.log`
  - 类型：command-output
  - 摘要：...
- E9（验证日志：build）：`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/build.log`
  - 类型：command-output
  - 摘要：...

## 2. 目标与成功标准（验收）
- AC1：...
- AC2：...

## 3. 验证矩阵（验收 AC# → 命令 → 证据E#）
| AC# | 验收项 | 命令 | 证据(E#) | 判定口径 |
| --- | --- | --- | --- | --- |
| AC1 | ... | `<命令>` | E8 | ... |
| AC2 | ... | `<命令>` | E9 | ... |

## 4. 风险与回滚（必须）
- 风险清单：...
- 兼容/灰度策略（如需）：...
- 回滚策略：...
- 数据/迁移回滚（如需）：...

## 5. 基线与对比验证（仅当优化/行为变化；否则写“不适用”）
不适用 / 适用：<选择其一并补全>

- Baseline（变更前）：
  - 指标/口径：...
  - 命令：`<命令>`
  - 证据：E?（`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/baseline-*.log`）
- Compare（变更后）：
  - 指标/口径：...
  - 命令：`<命令>`
  - 证据：E?（`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/compare-*.log`）
- 结论：<收益/无回归/不通过>

## 6. 方案与关键决策（概览，可追溯）
- 方案 A：...
  - 优点：...
  - 风险：...
- 方案 B：...
  - 优点：...
  - 风险：...
- 最终选择：...

## 7. 决策记录（D#，ADR 化，强制）
- D1：<标题>
  - 背景：...
  - 备选：...
  - 决策：...
  - 依据（E#）：E1/E2/E5 ...
  - 影响：...
  - 验证：AC# / 命令 / 证据(E#)
  - 回滚：...
  - 状态：提议 / 采纳 / 废弃

## 8. 实施步骤（原子化，可执行）
1. <文件/函数/逻辑概要>
   - 预期变更：...
   - 验收点：...
   - 风险/回滚点：...
2. ...

## 9. 风险闸门（risk_gate，事实记录）
- 阶段门禁确认（计划→执行，强制）：未确认 / 已确认（时间：...，原话：...）
- 命令：`python "$HOME/.codex/skills/zcf-workflow/scripts/risk_gate.py" --root "." --command "<将要执行的命令>" --out ".codex/evidence/20260104-104202-npm-upgrade-to-pnpm/risk_gate.txt"`
- 证据：E6（`.codex/evidence/20260104-104202-npm-upgrade-to-pnpm/risk_gate.txt`）
- 输出摘要：<风险等级/触发原因/最小验证集合>
- 若被阻断：
  - 用户确认记录：...
  - 放行命令：`python ".../risk_gate.py" ... --force --out ".codex/evidence/20260104-104202-npm-upgrade-to-pnpm/risk_gate.txt"`

## 10. 验证/命令记录（证据引用）
- `<命令>` → <结论>（证据：E#，时间：...）

## 11. 变更文件（事实）
- `path/to/file`（新增/修改/删除） - <原因/影响>

## 12. 文档/配置同步
- 更新了哪些文档/配置（如有）：...
- 新增/变更环境变量（如有）：...
- 部署/迁移注意事项（如有）：...

## 13. 未决问题
- ...

## 附录 A. 优化记录（[模式：优化]，必填：无则写“无”）
- 是否进入优化阶段：是 / 否
- 行为等价重构（可直接做；每条给出涉及文件/函数，并引用证据 E#）：...
- 性能/资源特征变化（需基线 + 对比验证；引用第 5 节）：不适用 / ...
- 行为变化（需确认 + 基线 + 对比验证；引用第 5 节）：不适用 / ...
- 结论：收益 / 无回归 / 不通过（若不通过：记录回滚点与后续动作）
